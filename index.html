"aseguradoEn": "RIVADAVIA",
                "contra": "SANCOR",
                "numeroReclamo": "RIV2024034",
                "observacion": "RECHAZADO POR FALTA DE COBERTURA",
                "fechaRevision": "",
                "estado": "RECHAZADO",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 820000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_10",
                        "fecha": "2024-10-15",
                        "texto": "RECHAZADO POR FALTA DE COBERTURA",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            }
        ];

        let siniestrosData = [];
        let editingSiniestroId = null;
        let editingField = null;

        // Funciones de persistencia
        function saveData() {
            try {
                localStorage.setItem('planilla_siniestros_data', JSON.stringify(siniestrosData));
                updateDataStatus('‚úÖ Datos guardados autom√°ticamente');
                return true;
            } catch (error) {
                console.error('Error guardando datos:', error);
                updateDataStatus('‚ùå Error al guardar datos', true);
                return false;
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('planilla_siniestros_data');
                if (savedData) {
                    const loadedData = JSON.parse(savedData);
                    if (Array.isArray(loadedData) && loadedData.length > 0) {
                        siniestrosData = sanitizeData(loadedData);
                        updateDataStatus('‚úÖ Datos cargados desde almacenamiento local');
                        return true;
                    }
                }
                // Si no hay datos guardados, usar datos iniciales
                siniestrosData = sanitizeData(JSON.parse(JSON.stringify(initialData)));
                saveData();
                updateDataStatus('üìã Planilla lista con datos iniciales');
                return true;
            } catch (error) {
                console.error('Error cargando datos:', error);
                siniestrosData = sanitizeData(JSON.parse(JSON.stringify(initialData)));
                updateDataStatus('‚ö†Ô∏è Error al cargar datos, usando datos iniciales', true);
                return false;
            }
        }

        function sanitizeData(data) {
            let sanitized = false;
            data.forEach(s => {
                if (!s.id) {
                    s.id = generateId();
                    sanitized = true;
                }
                if (!s.observaciones) {
                    s.observaciones = [];
                    sanitized = true;
                }
                s.observaciones.forEach(obs => {
                    if (!obs.id) {
                        obs.id = generateId();
                        sanitized = true;
                    }
                    if (typeof obs.completed === 'undefined') {
                        obs.completed = false;
                        sanitized = true;
                    }
                });
                updateSiniestroNextRevision(s);
            });
            if (sanitized) console.log("Datos sanitizados al cargar.");
            return data;
        }

        function updateDataStatus(message, isError = false) {
            const el = document.getElementById('dataStatus');
            el.textContent = message;
            el.style.background = isError ? '#f8d7da' : '#d4edda';
            el.style.borderColor = isError ? '#f5c6cb' : '#c3e6cb';
            el.style.color = isError ? '#721c24' : '#155724';
        }

        // Funciones de utilidad
        function formatDate(dateString) {
            if (!dateString) return 'No definida';
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('es-AR', { timeZone: 'UTC' });
        }

        function isToday(dateString) {
            if (!dateString) return false;
            const today = new Date();
            const compareDate = new Date(dateString + 'T00:00:00');
            return today.toDateString() === compareDate.toDateString();
        }

        function isPastDue(dateString) {
            if (!dateString) return false;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const compareDate = new Date(dateString + 'T00:00:00');
            return compareDate < today;
        }

        function getDaysDifference(dateString) {
            if (!dateString) return 999;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const compareDate = new Date(dateString + 'T00:00:00');
            return Math.ceil((compareDate - today) / (1000 * 60 * 60 * 24));
        }

        function generateId() {
            return `SIN_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }

        function getDisplayName(siniestro) {
            return `${siniestro.cliente} - Reclamo: ${siniestro.numeroReclamo || 'S/N'} (${siniestro.estado})`;
        }

        function formatCurrency(amount) {
            if (!amount || amount === '') return 'No especificado';
            const num = parseFloat(amount);
            if (isNaN(num)) return 'No especificado';
            return new Intl.NumberFormat('es-AR', {
                style: 'currency',
                currency: 'ARS',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(num);
        }

        // Funci√≥n para actualizar la pr√≥xima revisi√≥n de un siniestro
        function updateSiniestroNextRevision(siniestro) {
            if (!siniestro.observaciones) {
                siniestro.observaciones = [];
            }

            const futureObs = siniestro.observaciones
                .filter(obs => !obs.completed && obs.proximaRevision)
                .sort((a, b) => new Date(a.proximaRevision) - new Date(b.proximaRevision));
            
            if (futureObs.length > 0) {
                siniestro.fechaRevision = futureObs[0].proximaRevision;
                siniestro.observacion = futureObs[0].texto;
            } else {
                // Si no hay tareas pendientes, limpiar fechaRevision
                siniestro.fechaRevision = '';
                const lastObs = siniestro.observaciones[siniestro.observaciones.length - 1];
                siniestro.observacion = lastObs ? lastObs.texto : 'No hay tareas pendientes';
            }
        }

        // Funci√≥n para marcar/desmarcar como completada
        function toggleCompleted(event, siniestroId, obsId) {
            event.stopPropagation();
            const siniestro = siniestrosData.find(s => s.id === siniestroId);
            if (!siniestro) return;

            const obs = siniestro.observaciones.find(o => o.id === obsId);
            if (!obs) return;

            obs.completed = !obs.completed;
            updateSiniestroNextRevision(siniestro);
            saveData();
            renderAll();
        }

        // Funci√≥n principal de renderizado
        function renderAll() {
            // Actualizar todas las fechas de revisi√≥n
            siniestrosData.forEach(updateSiniestroNextRevision);
            renderDashboardLists();
            renderAllSiniestrosList();
        }

        // Renderizar listas del dashboard
        function renderDashboardLists() {
            const allTasks = siniestrosData.flatMap(siniestro => 
                (siniestro.observaciones || []).map(obs => ({
                    ...obs,
                    siniestro: siniestro
                }))
            );

            const todayTasks = allTasks.filter(task => 
                !task.completed && isToday(task.proximaRevision)
            );

            const overdueTasks = allTasks.filter(task => 
                !task.completed && isPastDue(task.proximaRevision)
            ).sort((a, b) => new Date(a.proximaRevision) - new Date(b.proximaRevision));

            const upcomingTasks = allTasks.filter(task => 
                !task.completed && getDaysDifference(task.proximaRevision) > 0 && getDaysDifference(task.proximaRevision) <= 30
            ).sort((a, b) => new Date(a.proximaRevision) - new Date(b.proximaRevision));

            renderReviewList('todayReviews', todayTasks, 'No hay revisiones para hoy', 'today');
            renderReviewList('overdueReviews', overdueTasks, 'No hay revisiones vencidas', 'overdue');
            renderReviewList('upcomingReviews', upcomingTasks, 'No hay pr√≥ximas revisiones', 'upcoming');
        }

        function renderReviewList(containerId, tasks, emptyMsg, type) {
            const container = document.getElementById(containerId);
            
            if (tasks.length === 0) {
                container.innerHTML = `<p style="color: rgba(255,255,255,0.8); font-style: italic; padding: 10px;">${emptyMsg}</p>`;
                return;
            }

            container.innerHTML = tasks.map(task => {
                let dateInfo = '';
                if (type === 'today') {
                    dateInfo = 'HOY';
                } else if (type === 'overdue') {
                    dateInfo = `VENCIDA - ${formatDate(task.proximaRevision)}`;
                } else {
                    const days = getDaysDifference(task.proximaRevision);
                    dateInfo = `En ${days} d√≠as - ${formatDate(task.proximaRevision)}`;
                }
                
                return `
                    <div class="review-item">
                        <button class="complete-btn" onclick="toggleCompleted(event, '${task.siniestro.id}', '${task.id}')">
                            ‚úîÔ∏è
                        </button>
                        <div class="review-item-content" onclick="showSiniestroModal('${task.siniestro.id}')">
                            <div class="review-date">${dateInfo}</div>
                            <div class="review-client">${task.siniestro.cliente}</div>
                            <div class="review-obs">${task.texto}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Renderizar lista completa de siniestros
        function renderAllSiniestrosList() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const estadoFilter = document.getElementById('estadoFilter').value;
            
            const filteredData = siniestrosData.filter(siniestro => {
                const matchesSearch = !searchTerm || Object.values(siniestro).some(value => 
                    String(value).toLowerCase().includes(searchTerm)
                );
                const matchesEstado = !estadoFilter || siniestro.estado === estadoFilter;
                return matchesSearch && matchesEstado;
            }).sort((a, b) => {
                // Ordenar por fecha de revisi√≥n
                const dateA = new Date(a.fechaRevision || '1900-01-01');
                const dateB = new Date(b.fechaRevision || '1900-01-01');
                return dateA - dateB;
            });

            const container = document.getElementById('allSiniestros');
            
            if (filteredData.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic; text-align: center; padding: 20px;">No se encontraron siniestros que coincidan con los filtros.</p>';
                return;
            }

            container.innerHTML = filteredData.map(siniestro => {
                const hasPendingTask = (siniestro.observaciones || []).some(obs => 
                    !obs.completed && obs.proximaRevision
                );
                
                let classes = 'review-item';
                if (!hasPendingTask) classes += ' completed';
                if (isToday(siniestro.fechaRevision)) classes += ' today';
                if (isPastDue(siniestro.fechaRevision)) classes += ' overdue';

                return `
                    <div class="${classes}" onclick="showSiniestroModal('${siniestro.id}')">
                        <div class="review-item-content">
                            <div class="review-date">
                                Pr√≥x. Revisi√≥n: ${formatDate(siniestro.fechaRevision)}
                            </div>
                            <div class="review-client">
                                ${siniestro.cliente} - Reclamo: ${siniestro.numeroReclamo || 'S/N'} - ${siniestro.estado}
                            </div>
                            <div class="review-obs">
                                Pr√≥xima tarea: ${siniestro.observacion}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Funciones de modales
        function showNewSiniestroModal() {
            document.getElementById('newSiniestroModal').classList.add('active');
            // Establecer fecha por defecto (una semana desde hoy)
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('newFechaRevision').value = nextWeek.toISOString().split('T')[0];
        }

        function showSiniestroSelectorModal() {
            const selector = document.getElementById('siniestroSelector');
            selector.innerHTML = '<option value="">-- Seleccionar Siniestro --</option>' +
                [...siniestrosData]
                    .sort((a, b) => a.cliente.localeCompare(b.cliente))
                    .map(siniestro => `<option value="${siniestro.id}">${getDisplayName(siniestro)}</option>`)
                    .join('');
            document.getElementById('siniestroSelectorModal').classList.add('active');
        }

        function loadSiniestroInfo() {
            const siniestroId = document.getElementById('siniestroSelector').value;
            if (siniestroId) {
                closeModal('siniestroSelectorModal');
                showSiniestroModal(siniestroId);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            editingSiniestroId = null;
            editingField = null;
        }

        function showSiniestroModal(siniestroId) {
            const siniestro = siniestrosData.find(s => s.id === siniestroId);
            if (!siniestro) return;

            // Actualizar pr√≥xima revisi√≥n antes de mostrar
            updateSiniestroNextRevision(siniestro);

            const content = `
                <h2>üè• ${siniestro.cliente}</h2>
                <div class="edit-mode-indicator">
                    üí° Haz clic en cualquier campo azul para editarlo
                </div>
                <div class="client-info">
                    <h4>üìã Informaci√≥n del Siniestro</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Cliente</div>
                            <div class="editable-field" id="field-cliente" onclick="editField('${siniestro.id}', 'cliente', '${(siniestro.cliente || '').replace(/'/g, '&#39;')}')">
                                <div class="info-value">${siniestro.cliente || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">DNI</div>
                            <div class="editable-field" id="field-dni" onclick="editField('${siniestro.id}', 'dni', '${siniestro.dni || ''}', 'number')">
                                <div class="info-value">${siniestro.dni || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Celular</div>
                            <div class="editable-field" id="field-celular" onclick="editField('${siniestro.id}', 'celular', '${siniestro.celular || ''}')">
                                <div class="info-value">${siniestro.celular || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Estado</div>
                            <div class="editable-field" id="field-estado" onclick="editFieldSelect('${siniestro.id}', 'estado', '${siniestro.estado || ''}')">
                                <div class="info-value">${siniestro.estado || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Asegurado En</div>
                            <div class="editable-field" id="field-aseguradoEn" onclick="editField('${siniestro.id}', 'aseguradoEn', '${(siniestro.aseguradoEn || '').replace(/'/g, '&#39;')}')">
                                <div class="info-value">${siniestro.aseguradoEn || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Contra</div>
                            <div class="editable-field" id="field-contra" onclick="editField('${siniestro.id}', 'contra', '${(siniestro.contra || '').replace(/'/g, '&#39;')}')">
                                <div class="info-value">${siniestro.contra || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">N¬∞ Reclamo</div>
                            <div class="editable-field" id="field-numeroReclamo" onclick="editField('${siniestro.id}', 'numeroReclamo', '${siniestro.numeroReclamo || ''}')">
                                <div class="info-value">${siniestro.numeroReclamo || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Presupuesto</div>
                            <div class="editable-field" id="field-presupuesto" onclick="editField('${siniestro.id}', 'presupuesto', '${siniestro.presupuesto || ''}', 'number')">
                                <div class="info-value">${formatCurrency(siniestro.presupuesto)}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Indemnizaci√≥n</div>
                            <div class="editable-field" id="field-indemnizacion" onclick="editField('${siniestro.id}', 'indemnizacion', '${siniestro.indemnizacion || ''}', 'number')">
                                <div class="info-value">${formatCurrency(siniestro.indemnizacion)}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Honorarios</div>
                            <div class="editable-field" id="field-honorarios" onclick="editField('${siniestro.id}', 'honorarios', '${siniestro.honorarios || ''}', 'number')">
                                <div class="info-value">${formatCurrency(siniestro.honorarios)}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Acuerdo</div>
                            <div class="editable-field" id="field-acuerdo" onclick="editField('${siniestro.id}', 'acuerdo', '${siniestro.acuerdo || ''}')">
                                <div class="info-value">${siniestro.acuerdo || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Fecha Pago</div>
                            <div class="editable-field" id="field-fechaPago" onclick="editField('${siniestro.id}', 'fechaPago', '${siniestro.fechaPago || ''}', 'date')">
                                <div class="info-value">${formatDate(siniestro.fechaPago)}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Factura</div>
                            <div class="editable-field" id="field-factura" onclick="editFieldSelect('${siniestro.id}', 'factura', '${siniestro.factura || ''}', ['SI', 'NO'])">
                                <div class="info-value">${siniestro.factura || 'No especificado'}</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Pr√≥xima Tarea</div>
                            <div class="info-value" style="color: #e74c3c; font-weight: bold;">
                                ${formatDate(siniestro.fechaRevision)}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="observations-history">
                    <h4>üìù Historial de Tareas</h4>
                    <div style="max-height: 300px; overflow-y: auto; margin-bottom: 15px;">
                        ${(siniestro.observaciones || []).length > 0 ? 
                            [...siniestro.observaciones]
                                .sort((a, b) => new Date(b.proximaRevision || '1900-01-01') - new Date(a.proximaRevision || '1900-01-01'))
                                .map(obs => {
                                    const isNextTask = obs.proximaRevision === siniestro.fechaRevision && 
                                                      obs.texto === siniestro.observacion && 
                                                      !obs.completed;
                                    return `
                                        <div class="obs-item ${obs.completed ? 'completed' : ''}" 
                                             style="${isNextTask ? 'border-left: 4px solid #e74c3c; background: #fff5f5;' : ''}">
                                            <div class="obs-date">
                                                ${formatDate(obs.fecha)}
                                                ${isNextTask ? ' <span style="color: #e74c3c; font-weight: bold;">(PR√ìXIMA TAREA)</span>' : ''}
                                                ${obs.completed ? ' <span style="color: #27ae60; font-weight: bold;">(COMPLETADA)</span>' : ''}
                                            </div>
                                            <div class="obs-text">${obs.texto}</div>
                                            <div class="obs-revision-date">
                                                Revisi√≥n: ${formatDate(obs.proximaRevision)}
                                            </div>
                                        </div>
                                    `;
                                }).join('') 
                            : '<p style="color: #666; font-style: italic; text-align: center; padding: 20px;">üìù No hay tareas registradas</p>'
                        }
                    </div>
                </div>

                <form class="form-section" onsubmit="addObservation(event, '${siniestro.id}')">
                    <h4>‚ûï Agregar Nueva Tarea</h4>
                    <div class="form-group">
                        <label>Descripci√≥n de la Tarea</label>
                        <textarea id="newObsText" rows="3" required placeholder="Descripci√≥n de lo que hay que hacer..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Fecha de Revisi√≥n</label>
                        <input type="date" id="newRevisionDate" required>
                    </div>
                    <div style="text-align: center;">
                        <button type="submit" class="btn btn-success">üíæ Guardar Tarea</button>
                    </div>
                </form>

                <div class="action-buttons">
                    <button class="btn btn-danger btn-sm" onclick="deleteSiniestro('${siniestro.id}')">üóëÔ∏è Eliminar Siniestro</button>
                    <button class="btn" onclick="closeModal('siniestroInfoModal')">‚ùå Cerrar</button>
                </div>
            `;

            document.getElementById('siniestroInfoContent').innerHTML = content;
            document.getElementById('siniestroInfoModal').classList.add('active');
        }

        // Funciones de edici√≥n
        function editField(siniestroId, fieldName, currentValue, inputType = 'text') {
            const siniestro = siniestrosData.find(s => s.id === siniestroId);
            if (!siniestro) return;

            editingSiniestroId = siniestroId;
            editingField = fieldName;

            const fieldElement = document.getElementById(`field-${fieldName}`);
            if (!fieldElement) return;

            const input = document.createElement('input');
            input.type = inputType;
            input.value = currentValue || '';
            input.className = 'form-control';
            input.style.width = '100%';
            input.style.padding = '4px 8px';
            input.style.border = '2px solid #3498db';
            input.style.borderRadius = '4px';

            fieldElement.innerHTML = '';
            fieldElement.appendChild(input);
            fieldElement.classList.add('editing');

            input.focus();
            input.select();

            input.addEventListener('blur', saveField);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveField();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit(currentValue);
                }
            });
        }

        function editFieldSelect(siniestroId, fieldName, currentValue, options = null) {
            const siniestro = siniestrosData.find(s => s.id === siniestroId);
            if (!siniestro) return;

            editingSiniestroId = siniestroId;
            editingField = fieldName;

            const fieldElement = document.getElementById(`field-${fieldName}`);
            if (!fieldElement) return;

            let selectOptions;
            if (fieldName === 'estado') {
                selectOptions = ['EJECUCION', 'FINALIZADA', 'FINALIZADA P', 'RECHAZADO', 'DEMORADA'];
            } else if (options) {
                selectOptions = options;
            } else {
                editField(siniestroId, fieldName, currentValue);
                return;
            }

            const selectElement = document.createElement('select');
            selectElement.className = 'form-control';
            selectElement.style.width = '100%';
            selectElement.style.padding = '4px 8px';
            selectElement.style.border = '2px solid #3498db';
            selectElement.style.borderRadius = '4px';

            selectElement.innerHTML = selectOptions.map(option => 
                `<option value="${option}" ${option === currentValue ? 'selected' : ''}>${option}</option>`
            ).join('');

            fieldElement.innerHTML = '';
            fieldElement.appendChild(selectElement);
            fieldElement.classList.add('editing');

            selectElement.focus();

            selectElement.addEventListener('blur', saveField);
            selectElement.addEventListener('change', saveField);
        }

        function saveField() {
            if (!editingSiniestroId || !editingField) return;

            const siniestro = siniestrosData.find(s => s.id === editingSiniestroId);
            if (!siniestro) return;

            const fieldElement = document.getElementById(`field-${editingField}`);
            const inputElement = fieldElement.querySelector('input, select');
            
            if (!inputElement) return;

            let newValue = inputElement.value.trim();

            // Actualizar el dato en el siniestro
            siniestro[editingField] = newValue;

            // Restaurar la vista normal
            let displayValue = newValue || 'No especificado';
            
            // Formatear valores especiales
            if (['presupuesto', 'indemnizacion', 'honorarios'].includes(editingField)) {
                displayValue = formatCurrency(newValue);
            } else if (['fechaPago'].includes(editingField)) {
                displayValue = formatDate(newValue);
            }
            
            fieldElement.innerHTML = `<div class="info-value">${displayValue}</div>`;
            fieldElement.classList.remove('editing');

            editingSiniestroId = null;
            editingField = null;

            // Guardar datos y actualizar la vista
            saveData();
            renderAll();
        }

        function cancelEdit(originalValue) {
            if (!editingField) return;

            const fieldElement = document.getElementById(`field-${editingField}`);
            
            let displayValue = originalValue || 'No especificado';
            
            // Formatear valores especiales
            if (['presupuesto', 'indemnizacion', 'honorarios'].includes(editingField)) {
                displayValue = formatCurrency(originalValue);
            } else if (['fechaPago'].includes(editingField)) {
                displayValue = formatDate(originalValue);
            }
            
            fieldElement.innerHTML = `<div class="info-value">${displayValue}</div>`;
            fieldElement.classList.remove('editing');

            editingSiniestroId = null;
            editingField = null;
        }

        function deleteSiniestro(siniestroId) {
            const siniestro = siniestrosData.<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilla de Siniestros - Garc√≠a & Asociados</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .main-content { padding: 30px; }
        .dashboard {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px; margin-bottom: 40px;
        }
        .card {
            background: white; border-radius: 12px; padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 1px solid #e0e0e0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .card h3 {
            color: #2c3e50; margin-bottom: 20px; font-size: 1.3em;
            display: flex; align-items: center; gap: 10px;
        }
        .icon { width: 24px; height: 24px; fill: currentColor; }
        .today-reviews { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; }
        .overdue-reviews { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; }
        .pending-reviews { background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%); color: white; }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 12px 24px; border-radius: 8px;
            cursor: pointer; font-size: 1em; transition: all 0.3s ease; margin: 5px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4); }
        .btn-success { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
        .btn-info { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .btn-warning { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
        .btn-sm { padding: 8px 16px; font-size: 0.9em; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 2px solid #e0e0e0;
            border-radius: 8px; font-size: 1em; transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .reviews-list { max-height: 400px; overflow-y: auto; }
        .review-item {
            background: #f8f9fa; border-left: 4px solid #667eea; padding: 15px;
            margin-bottom: 10px; border-radius: 0 8px 8px 0; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 10px;
        }
        .review-item-content { flex-grow: 1; cursor: pointer; }
        .review-item.completed .review-item-content { text-decoration: line-through; opacity: 0.6; }
        .review-item.completed { border-left-color: #2ecc71; background-color: #f2fdf5; }
        .review-item:hover { background: #e8f2ff; transform: translateX(5px); }
        .review-item.today { border-left-color: #e74c3c; background: #fff5f5; }
        .review-item.overdue { border-left-color: #f39c12; background: #fef9e7; }
        .review-date { font-weight: 600; color: #2c3e50; font-size: 1.1em; }
        .review-client { font-size: 1em; color: #667eea; margin: 5px 0; }
        .review-obs { font-size: 0.9em; color: #666; font-style: italic; }
        .complete-btn {
            background: #e0e0e0; border: none; width: 30px; height: 30px;
            border-radius: 50%; cursor: pointer; transition: all 0.3s ease;
            font-size: 16px; flex-shrink: 0;
        }
        .complete-btn:hover { background: #c0c0c0; }
        .review-item.completed .complete-btn { background: #2ecc71; color: white; }
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 1000;
        }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: white; border-radius: 15px; padding: 30px; width: 95%;
            max-width: 900px; max-height: 90vh; overflow-y: auto; animation: modalSlide 0.3s ease;
        }
        @keyframes modalSlide { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .client-info { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .client-info h4 { color: #2c3e50; margin-bottom: 15px; font-size: 1.2em; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .info-grid.full-width > .info-item { grid-column: 1 / -1; }
        .info-item { background: white; padding: 12px; border-radius: 5px; border-left: 3px solid #667eea; }
        .info-label { font-size: 0.8em; color: #666; text-transform: uppercase; font-weight: 600; }
        .info-value { font-size: 1em; color: #2c3e50; margin-top: 2px; font-weight: 500; }
        .editable-field { cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background-color 0.3s ease; min-height: 20px; }
        .editable-field:hover { background-color: #e8f4fd; color: #2980b9; }
        .editable-field.editing { background-color: #fff; border: 2px solid #3498db; }
        .observations-history { margin-top: 20px; }
        .obs-item { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px; position: relative; }
        .obs-date { font-size: 0.9em; color: #667eea; font-weight: 600; margin-bottom: 5px; }
        .obs-text { color: #2c3e50; }
        .obs-revision-date { font-size: 0.8em; color: #c0392b; margin-top: 5px; font-weight: 500; }
        .close { float: right; font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; line-height: 1; }
        .close:hover { color: #000; }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; justify-content: center; }
        .data-status {
            background: #d4edda; border: 1px solid #c3e6cb; color: #155724;
            padding: 10px; border-radius: 8px; margin-bottom: 20px; text-align: center;
        }
        .filter-bar {
            background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }
        .form-section { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-top: 20px; }
        .form-section h4 { color: #2c3e50; margin-bottom: 15px; font-size: 1.2em; }
        @media (max-width: 768px) { 
            .dashboard, .filter-bar, .info-grid { grid-template-columns: 1fr; } 
            .main-content { padding: 20px; } 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Planilla de Siniestros</h1>
            <p>Garc√≠a & Asociados - Gesti√≥n de Reclamos y Seguros</p>
        </div>

        <div class="main-content">
            <div id="dataStatus" class="data-status">Cargando datos...</div>

            <!-- DASHBOARD DE TAREAS -->
            <div class="dashboard">
                <div class="card today-reviews">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                        </svg>
                        Revisiones de Hoy
                    </h3>
                    <div class="reviews-list" id="todayReviews"></div>
                </div>
                <div class="card overdue-reviews">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                        Revisiones Vencidas
                    </h3>
                    <div class="reviews-list" id="overdueReviews"></div>
                </div>
                <div class="card pending-reviews">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        Pr√≥ximas Revisiones
                    </h3>
                    <div class="reviews-list" id="upcomingReviews"></div>
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-success" onclick="showNewSiniestroModal()">‚ûï Agregar Siniestro</button>
                <button class="btn" onclick="showSiniestroSelectorModal()">üëÅÔ∏è Ver/Editar Siniestro</button>
                <button class="btn" onclick="exportToExcel()">üìä Exportar a Excel</button>
                <button class="btn" onclick="exportData()">üíæ Exportar JSON</button>
                <button class="btn btn-warning" onclick="importData()">üì• Importar Datos</button>
            </div>

            <div class="filter-bar">
                <div class="form-group">
                    <label>B√∫squeda General</label>
                    <input type="text" id="searchInput" placeholder="Buscar por cliente, DNI, reclamo, etc." onkeyup="renderAllSiniestrosList()">
                </div>
                <div class="form-group">
                    <label>Filtrar por Estado</label>
                    <select id="estadoFilter" onchange="renderAllSiniestrosList()">
                        <option value="">Todos los estados</option>
                        <option value="RECHAZADO">Rechazado</option>
                        <option value="FINALIZADA">Finalizada</option>
                        <option value="FINALIZADA P">Finalizada P</option>
                        <option value="EJECUCION">Ejecuci√≥n</option>
                        <option value="DEMORADA">Demorada</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h3>üìã Todos los Siniestros (Ordenados por fecha de revisi√≥n)</h3>
                <div class="reviews-list" id="allSiniestros" style="max-height: 600px;"></div>
            </div>
        </div>
    </div>

    <input type="file" id="importInput" accept=".json" style="display: none;" onchange="handleImport(event)">

    <!-- MODALES -->
    <div id="newSiniestroModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('newSiniestroModal')">&times;</span>
            <h2>‚ûï Agregar Nuevo Siniestro</h2>
            <form id="newSiniestroForm">
                <div class="info-grid">
                    <div class="form-group">
                        <label>Cliente *</label>
                        <input type="text" id="newCliente" required>
                    </div>
                    <div class="form-group">
                        <label>DNI</label>
                        <input type="number" id="newDni">
                    </div>
                    <div class="form-group">
                        <label>Celular</label>
                        <input type="tel" id="newCelular">
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="newEstado" required>
                            <option value="">Seleccionar estado</option>
                            <option value="EJECUCION">En Ejecuci√≥n</option>
                            <option value="FINALIZADA">Finalizada</option>
                            <option value="FINALIZADA P">Finalizada P</option>
                            <option value="RECHAZADO">Rechazado</option>
                            <option value="DEMORADA">Demorada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Asegurado En</label>
                        <input type="text" id="newAseguradoEn">
                    </div>
                    <div class="form-group">
                        <label>Contra</label>
                        <input type="text" id="newContra">
                    </div>
                    <div class="form-group">
                        <label>N¬∞ Reclamo</label>
                        <input type="text" id="newNumeroReclamo">
                    </div>
                    <div class="form-group">
                        <label>Presupuesto</label>
                        <input type="number" id="newPresupuesto">
                    </div>
                </div>
                <div class="form-group">
                    <label>Tarea Inicial</label>
                    <textarea id="newObservacion" rows="3" placeholder="Descripci√≥n de la primera tarea..."></textarea>
                </div>
                <div class="form-group">
                    <label>Fecha de Revisi√≥n</label>
                    <input type="date" id="newFechaRevision">
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-success">üíæ Guardar Siniestro</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('newSiniestroModal')">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="siniestroSelectorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('siniestroSelectorModal')">&times;</span>
            <h2>üëÅÔ∏è Seleccionar Siniestro</h2>
            <div class="form-group">
                <label>Siniestro</label>
                <select id="siniestroSelector" onchange="loadSiniestroInfo()">
                    <option value="">-- Seleccionar Siniestro --</option>
                </select>
            </div>
        </div>
    </div>

    <div id="siniestroInfoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('siniestroInfoModal')">&times;</span>
            <div id="siniestroInfoContent"></div>
        </div>
    </div>
    
    <script>
        // DATOS INICIALES (TU EXCEL)
        const initialData = [
            {
                "id": "SINIESTRO_1_1735933845000",
                "fecha": "",
                "cliente": "GONCALVES BEATRIZ",
                "dni": "22108382",
                "celular": "1164233680",
                "aseguradoEn": "RIVADAVIA",
                "contra": "ORBIS",
                "numeroReclamo": "232644",
                "observacion": "SE INFORMO A CLIENTE QUE NO SE DARA RESOLUCION POR ORBIS NO DA RESPUESTA",
                "fechaRevision": "",
                "estado": "RECHAZADO",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 1140000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_1",
                        "fecha": "2025-04-30",
                        "texto": "SE INFORMO A CLIENTE QUE NO SE DARA RESOLUCION POR ORBIS NO DA RESPUESTA",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            },
            {
                "id": "SINIESTRO_2_1735933845001",
                "fecha": "2025-05-06",
                "cliente": "GRANADO MIGUEL ANGEL",
                "dni": "21543471",
                "celular": "1173653571",
                "aseguradoEn": "COPAN",
                "contra": "ZURICH",
                "numeroReclamo": "0",
                "observacion": "SE INFOMO A CLIENTE QUE ZURICH NO CUBRE EL PARABRISAS",
                "fechaRevision": "",
                "estado": "RECHAZADO",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 285999.99,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_2",
                        "fecha": "2025-05-20",
                        "texto": "SE INFOMO A CLIENTE QUE ZURICH NO CUBRE EL PARABRISAS",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            },
            {
                "id": "SINIESTRO_3_1735933845002",
                "fecha": "",
                "cliente": "SILGUEIRO VICTOR",
                "dni": "34566518",
                "celular": "",
                "aseguradoEn": "FEDERACION",
                "contra": "LA CAJA",
                "numeroReclamo": "54000113645",
                "observacion": "SE FUE CON NEMESIS",
                "fechaRevision": "",
                "estado": "RECHAZADO",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 1074000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_3",
                        "fecha": "2025-05-26",
                        "texto": "SE FUE CON NEMESIS",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            },
            {
                "id": "SINIESTRO_4_1735933845003",
                "fecha": "",
                "cliente": "GALEPPI SUSANA",
                "dni": "11130200",
                "celular": "1151388650",
                "aseguradoEn": "GALENO",
                "contra": "SAN CRIST√ìBAL",
                "numeroReclamo": "UC368744",
                "observacion": "NO HIZO LA DENUECIA LE 3RO",
                "fechaRevision": "",
                "estado": "RECHAZADO",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 530000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_4",
                        "fecha": "2025-05-26",
                        "texto": "NO HIZO LA DENUECIA LE 3RO",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            },
            {
                "id": "SINIESTRO_5_1735933845004",
                "fecha": "2025-04-01",
                "cliente": "ALVAREZ CLAUDIA",
                "dni": "28456789",
                "celular": "1145678901",
                "aseguradoEn": "COPAN",
                "contra": "FEDERACION",
                "numeroReclamo": "CP2025001",
                "observacion": "PERITAJE REALIZADO, ESPERANDO LIQUIDACION",
                "fechaRevision": "2025-12-31",
                "estado": "EJECUCION",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 890000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_5",
                        "fecha": "2025-04-15",
                        "texto": "PERITAJE REALIZADO, ESPERANDO LIQUIDACION",
                        "proximaRevision": "2025-12-31",
                        "completed": false
                    }
                ]
            },
            {
                "id": "SINIESTRO_6_1735933845005",
                "fecha": "2024-12-15",
                "cliente": "RODRIGUEZ MARIA",
                "dni": "32567890",
                "celular": "1156789012",
                "aseguradoEn": "FEDERACION",
                "contra": "SANCOR",
                "numeroReclamo": "FED2024089",
                "observacion": "CASO FINALIZADO CON ACUERDO TOTAL",
                "fechaRevision": "",
                "estado": "FINALIZADA",
                "acuerdo": "SI",
                "fechaPago": "2025-01-15",
                "presupuesto": 1250000,
                "indemnizacion": 1250000,
                "honorarios": 187500,
                "factura": "SI",
                "observaciones": [
                    {
                        "id": "obs_6",
                        "fecha": "2025-01-10",
                        "texto": "CASO FINALIZADO CON ACUERDO TOTAL",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            },
            {
                "id": "SINIESTRO_7_1735933845006",
                "fecha": "2024-11-20",
                "cliente": "MARTINEZ CARLOS",
                "dni": "29345678",
                "celular": "1167890123",
                "aseguradoEn": "RIVADAVIA",
                "contra": "ZURICH",
                "numeroReclamo": "RIV2024045",
                "observacion": "FINALIZADO CON PAGO PARCIAL ACORDADO",
                "fechaRevision": "",
                "estado": "FINALIZADA P",
                "acuerdo": "SI",
                "fechaPago": "2024-12-25",
                "presupuesto": 2100000,
                "indemnizacion": 1575000,
                "honorarios": 236250,
                "factura": "SI",
                "observaciones": [
                    {
                        "id": "obs_7",
                        "fecha": "2024-12-20",
                        "texto": "FINALIZADO CON PAGO PARCIAL ACORDADO",
                        "proximaRevision": "",
                        "completed": true
                    }
                ]
            },
            {
                "id": "SINIESTRO_8_1735933845007",
                "fecha": "2025-01-10",
                "cliente": "LOPEZ PATRICIA",
                "dni": "30456789",
                "celular": "1178901234",
                "aseguradoEn": "COPAN",
                "contra": "LA CAJA",
                "numeroReclamo": "CP2025002",
                "observacion": "DOCUMENTACION ADICIONAL SOLICITADA",
                "fechaRevision": "2025-03-01",
                "estado": "DEMORADA",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 675000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_8",
                        "fecha": "2025-02-01",
                        "texto": "DOCUMENTACION ADICIONAL SOLICITADA",
                        "proximaRevision": "2025-03-01",
                        "completed": false
                    }
                ]
            },
            {
                "id": "SINIESTRO_9_1735933845008",
                "fecha": "2024-10-15",
                "cliente": "GARCIA FERNANDO",
                "dni": "31567890",
                "celular": "1189012345",
                "aseguradoEn": "FEDERACION",
                "contra": "ORBIS",
                "numeroReclamo": "FED2024067",
                "observacion": "PERITAJE FAVORABLE, EN LIQUIDACION",
                "fechaRevision": "2025-01-15",
                "estado": "EJECUCION",
                "acuerdo": "",
                "fechaPago": "",
                "presupuesto": 1450000,
                "indemnizacion": "",
                "honorarios": "",
                "factura": "NO",
                "observaciones": [
                    {
                        "id": "obs_9",
                        "fecha": "2024-11-30",
                        "texto": "PERITAJE FAVORABLE, EN LIQUIDACION",
                        "proximaRevision": "2025-01-15",
                        "completed": false
                    }
                ]
            },
            {
                "id": "SINIESTRO_10_1735933845009",
                "fecha": "2024-09-05",
                "cliente": "FERNANDEZ ANA",
                "dni": "27890123",
                "celular": "1190123456",
                "as
